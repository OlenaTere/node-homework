SELECT o.order_id, SUM(p.price * l.quantity) AS total_price FROM orders o JOIN line_items l ON o.order_id = l.order_id JOIN products p ON l.product_id = p.product_id GROUP BY o.order_id ORDER BY o.order_id LIMIT 5;
SELECT c.customer_name, AVG(t.total_price) AS average_order_price FROM customers c JOIN (SELECT o.customer_id, SUM(p.price * l.quantity) AS total_price FROM orders o JOIN line_items l ON o.order_id = l.order_id JOIN products p ON l.product_id = p.product_id GROUP BY o.order_id, o.customer_id) t ON c.customer_id = t.customer_id GROUP BY c.customer_id, c.customer_name ORDER BY c.customer_name;
SELECT customer_id FROM customers WHERE customer_name = 'Perez and Sons';
SELECT employee_id FROM employees WHERE first_name = 'Miranda' AND last_name = 'Harris';
SELECT product_id FROM products ORDER BY price ASC LIMIT 5;
BEGIN;
INSERT INTO orders (customer_id, employee_id, date) VALUES (16, 7, '2025-03-11') RETURNING order_id;
INSERT INTO line_items (order_id, product_id, quantity) VALUES (253, 23, 10), (253, 18, 10), (253, 43, 10), (253, 9, 10), (253, 44, 10);
COMMIT;
SELECT * FROM line_items WHERE order_id = 253;
SELECT e.first_name, e.last_name, COUNT(o.order_id) AS order_count FROM employees e JOIN orders o ON e.employee_id = o.employee_id GROUP BY e.employee_id, e.first_name, e.last_name HAVING COUNT(o.order_id) > 5 ORDER BY e.last_name;
